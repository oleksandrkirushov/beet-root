<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>JS_HW_NEWS_BLOG</title>
        <style>
            .wrapp {
                display: flex;

            }

            .wrapp>div {
                width: 50%;
                padding: 15px;
                box-sizing: border-box;
            }

            .app__form {
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                height: 210px;
            }

            .app__btn {
                width: 100px;
                align-self: flex-end;
            }

            .hidden {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="wrapp">
            <div id="app">
                <form class="app__form hidden" action="" method="dialog">
                    <input type="text" name="heading" value="">
                    <textarea name="news" value="" id="" cols="30" rows="10"></textarea>
                    <input class="app__btn" type="submit">
                </form>
                <button class="app__open">Открыть</button>
                <button class="app__close hidden">Закрыть</button>
            </div>
        </div>
        <script>
            const btnOpen = document.querySelector('.app__open');
            const btnClose = document.querySelector('.app__close');
            const formS = document.querySelector('.app__form');

            btnOpen.addEventListener('click', function (e) {
                showHidden(formS);
                showHidden(btnClose);
                showHidden(btnOpen);

            });
            btnClose.addEventListener('click', function (e) {
                showHidden(formS);
                showHidden(btnClose);
                showHidden(btnOpen);

            });

            function showHidden(element) {
                if (element.classList.contains('hidden')) {
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                }
            };

            function Message(options) {
                this.option = {
                    form: options.form,
                    wrapper: options.wrapper
                }
                this.messageList = [];

            };

            Message.prototype.renderHtmlMessage = function () {
                const form = this.option.form;
                const wrapper = this.option.wrapper;
                wrapper.innerHTML = '';
                wrapper.appendChild(form);
                wrapper.appendChild(btnOpen);
                wrapper.appendChild(btnClose);
                this.messageList.forEach(message => {
                    wrapper.insertAdjacentHTML('beforeend', `
                    <div class="article${message.id+1}">
                    <h2>${message.id+1}.${message.title}.</h2>
                    <p>${message.content}</p>
                    <p>${message.date}</p>
                    <button class="delete${message.id+1}">Удалить</button>
                    </div>
                    `);
                });

                const btnDelList = document.querySelectorAll('button[class^="delete"]');

                btnDelList.forEach(function (item, index) {
                    btnDelList[index].addEventListener('click', function (event) {
                        const arrBtnDelList = [...document.querySelectorAll(
                            'button[class^="delete"]')];
                        const indexOf = arrBtnDelList.indexOf(event.target);
                        arrBtnDelList.splice(indexOf, 1);
                        wrapper.removeChild(event.target.parentElement);
                        message.messageList.splice(indexOf, 1);
                        const articleDelList = document.querySelectorAll(
                            'div[class^="article"]');

                        for (let i = (indexOf); i < articleDelList.length; i++) {
                            articleDelList[i].firstElementChild.innerHTML =
                                `${i+1}.${message.messageList[i].title}.`;
                            message.messageList[i].id = i;
                        }
                    })
                })
            };

            Message.prototype.addMessage = function (message) {
                message.id = this.messageList.length;
                message.date = new Date();
                this.messageList.push(message);
                this.renderHtmlMessage();
            };

            Message.prototype.removeMessage = function (messageId) {};

            const message = new Message({
                wrapper: document.getElementById('app'),
                form: document.querySelector('.app__form'),
            });

            message.option.form.addEventListener('submit', function () {
                message.addMessage({
                    title: message.option.form[0].value,
                    content: message.option.form[1].value,
                });
                message.option.form.reset();
            });
        </script>
    </body>
</html>
